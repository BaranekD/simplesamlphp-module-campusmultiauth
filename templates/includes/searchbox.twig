{% if configuration.priority is not defined %}
    {% set configuration = configuration|merge({'priority': 'secondary'}) %}
{% endif %}

<div class="list-group text-left idps-form-div d-none vhide">
    <form id="idps-form-{{ component_index }}" action="{{ currentUrl }}" method="post">
        <label for="searchbox" class="text-bold {% if muni_jvs %}color-{{ configuration.priority }}{% else %}text-{% if configuration.priority == 'primary' %}dark{% else %}muted{% endif %}{% endif %}">
        {% if attribute(configuration.title, currentLanguage) is defined %}{{ attribute(configuration.title, currentLanguage) }}
            {% elseif configuration.title is defined and configuration.title is iterable and configuration.title is not empty %}{{ configuration.title | first }}
            {% elseif configuration.title is defined and configuration.title is not iterable %}{{ configuration.title }}
            {% else %}{{ '{campusmultiauth:searchbox_title}'|trans }}
            {% endif %}
        </label>
        <input type="text" name="searchbox" id="searchbox-{{ component_index }}" value="" class="
            {% if muni_jvs %}
                inp-text js-suggest searchbox-input input-height selectized color-border-{{ configuration.priority }}
            {% else %}
                border border-2 input-height border-{% if configuration.priority == 'primary' %}dark{% else %}muted{% endif %}
            {% endif %}">

        {% if cookie_idpentityid is not null and cookie_component_index == component_index %}
            {% if muni_jvs %}
                <div class="box-vcards-list__item box-vcard--compact searchbox-result side-padding-zero">
                    <button class="preferred-idp" type="submit">
                        <div class="box-vcards-list__inner side-padding-zero">
                            <p class="box-vcards-list__img center">
                                <img src="{{ cookie_institution_img }}" class="img-searchbox"/>
                            </p>
                            <div class="box-vcards-list__content u-pb-0 u-pt-0 u-pr-0 u-pl-10">
                                {% if attribute(cookie_institution_name, currentLanguage) is defined %}{{ attribute(cookie_institution_name, currentLanguage) }}{% else %}{{ cookie_institution_name.en}}{% endif %}
                            </div>
                        </div>
                    </button>
                </div>
            {% else %}
                <button class="list-group-item list-group-item-action d-flex align-items-center" type="submit">
                    <span class="mb-0">
                        <img src="{{ cookie_institution_img }}" class="img-searchbox" alt=""/>
                    </span>
                    <span class="margin-left-24">
                        {% if attribute(cookie_institution_name, currentLanguage) is defined %}{{ attribute(cookie_institution_name, currentLanguage) }}{% else %}{{ cookie_institution_name.en}}{% endif %}
                    </span>
                 </button>
            {% endif %}
        {% endif %}

        <input type="hidden" id="componentIndex" name="componentIndex" value="{{ component_index }}" />
        <input type="hidden" id="authstate" name="authstate" value="{{ authstate }}" />
        <input type="hidden" id="source" name="source" value="{{ sp_source_name }}" />
    </form>
</div>

{% if attribute(configuration.placeholder, currentLanguage) is defined %}
    {% set placeholder = attribute(configuration.placeholder, currentLanguage) %}
{% elseif configuration.placeholder is defined and configuration.placeholder is iterable and configuration.placeholder is not empty %}
    {% set placeholder =  configuration.placeholder | first %}
{% elseif configuration.placeholder is defined and configuration.placeholder is not iterable %}
    {% set placeholder = configuration.placeholder %}
{% else %}
    {% set placeholder = '{campusmultiauth:searchbox_placeholder}'|trans %}
{% endif %}

{% if idps == null or component_index != no_js_display_index %}
    <div class="idps-form-nojs-div list-group text-left">
        <label for="q" class="{% if muni_jvs %}color-{{ configuration.priority }}{% else %}form-label text-{% if configuration.priority == 'primary' %}dark{% else %}muted{% endif %}{% endif %}">
        {% if attribute(configuration.title, currentLanguage) is defined %}{{ attribute(configuration.title, currentLanguage) }}
            {% elseif configuration.title is defined and configuration.title is iterable and configuration.title is not empty %}{{ configuration.title | first }}
            {% elseif configuration.title is defined and configuration.title is not iterable %}{{ configuration.title }}
            {% else %}{{ '{campusmultiauth:searchbox_title}'|trans }}
            {% endif %}
        </label>
        <form id="idps-form-nojs" class="form-inline" action="{{ currentUrl }}" method="post">
        {% if muni_jvs %}
                <p class="size--m--4-4 size--l--10-12">
                    <span class="inp-fix">
                        <input id="q" class="inp-text" type="text" name="q" placeholder="{{ placeholder }}">
                    </span>
                </p>
                <p>
                    <button class="btn btn-primary btn-s nowrap full-width" type="submit">
                        <span>{{ '{campusmultiauth:search_button}'|trans }}</span>
                    </button>
                </p>
        {% else %}
                <div class="input-group">
                    <input id="q" name="q" type="text" placeholder="{{ placeholder }}" class="form-control border border-2 border-{% if configuration.priority == 'primary' %}dark{% else %}muted{% endif %} input-height" aria-describedby="submit-search">
                    <button id="submit-search" class="btn btn-{% if configuration.priority == 'primary' %}primary{% else %}secondary{% endif %}" type="submit">{{ '{campusmultiauth:search_button}'|trans }}</button>
                </div>
        {% endif %}

            <input type="hidden" id="componentIndex" name="componentIndex" value="{{ component_index }}" />
            <input type="hidden" id="currentLanguage" name="currentLanguage" value="{{ currentLanguage }}" />
            <input type="hidden" id="authstate" name="authstate" value="{{ authstate }}" />
        </form>
    </div>
{% else %}
    <div class="idps-form-nojs-div list-group div-nojs">
        <form id="idps-{{ component_index }}" action="{{ currentUrl }}" method="post">
            {% for idp in idps.items %}
                {% if muni_jvs %}
                    <button class="metaentry list-group-item" type="submit" name="idpentityid" value="{{ idp.idpentityid }}">
                        <div class="box-vcards-list__item box-vcard--compact searchbox-result side-padding-zero">
                            <div class="box-vcards-list__inner side-padding-zero">
                                <p class="box-vcards-list__img center">
                                    <img src="{{ idp.image }}" class="img-searchbox">
                                </p>
                                <div class="box-vcards-list__content u-pb-0 u-pt-0 u-pr-0 u-pl-10">
                                    {{ idp.text }}
                                </div>
                            </div>
                        </div>
                    </button>
                {% else %}
                    <button class="list-group-item list-group-item-action d-flex align-items-center text-left" type="submit" name="idpentityid" value="{{ idp.idpentityid }}">
                        <span class="mb-0">
                            <img src="{{ idp.image }}" class="img-searchbox" alt=""/>
                        </span>
                        <span class="margin-left-24">
                            {{ idp.text }}
                        </span>
                    </button>
                {% endif %}
            {% endfor %}

            <input type="hidden" id="authstate" name="authstate" value="{{ authstate }}" />
            <input type="hidden" id="source" name="source" value="{{ sp_source_name }}" />
        </form>
    </div>
{% endif %}
